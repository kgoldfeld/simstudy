<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Framework for repeated simulations • simstudy</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Framework for repeated simulations">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simstudy</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.9.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/simstudy.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/clustered.html">Clustered Data</a>
    </li>
    <li>
      <a href="../articles/corelationmat.html">Correlation Matrices</a>
    </li>
    <li>
      <a href="../articles/correlated.html">Correlated Data</a>
    </li>
    <li>
      <a href="../articles/customdist.html">Customized Distributions</a>
    </li>
    <li>
      <a href="../articles/double_dot_extension.html">Dynamic Data Definition</a>
    </li>
    <li>
      <a href="../articles/framework.html">Framework for repeated simulations</a>
    </li>
    <li>
      <a href="../articles/logisticCoefs.html">Targeted logistic model coefficients</a>
    </li>
    <li>
      <a href="../articles/longitudinal.html">Longitudinal Data</a>
    </li>
    <li>
      <a href="../articles/missing.html">Missing Data</a>
    </li>
    <li>
      <a href="../articles/ordinal.html">Ordinal Categorical Data</a>
    </li>
    <li>
      <a href="../articles/spline.html">Spline Data</a>
    </li>
    <li>
      <a href="../articles/survival.html">Survival Data</a>
    </li>
    <li>
      <a href="../articles/treat_and_exposure.html">Treatment and Exposure</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kgoldfeld/simstudy/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Framework for repeated simulations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kgoldfeld/simstudy/blob/main/vignettes/framework.Rmd" class="external-link"><code>vignettes/framework.Rmd</code></a></small>
      <div class="hidden name"><code>framework.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kgoldfeld/simstudy" class="external-link">simstudy</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/runehaubo/lmerTestR" class="external-link">lmerTest</a></span><span class="op">)</span> </span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>simstudy</code> package began as a small collection of
functions to streamline data generation for repeated simulations. Over
time, it has grown to include tools that support reproducible simulation
workflows, but the underlying motivation remains the same—replicability
and organization.</p>
<p>This vignette describes a general framework for conducting repeated
data generation and model fitting, a process that arises frequently in
both power analysis and operating-characteristics evaluation. While the
examples use <code>simstudy</code>, the structure is general enough to
apply in many contexts.</p>
</div>
<div class="section level2">
<h2 id="the-simulation-framework">The simulation framework<a class="anchor" aria-label="anchor" href="#the-simulation-framework"></a>
</h2>
<p>The basic workflow involves generating data under a variety of
assumptions—such as different sample sizes, effect sizes, or variance
levels—and, for each set of assumptions, repeating the data generation
many times to mimic sampling from a population.</p>
<p>The process generally starts with three basic steps:</p>
<ol style="list-style-type: decimal">
<li>Defining the data structures</li>
<li>Generating a dataset for one scenario</li>
<li>Fitting a model to that dataset</li>
</ol>
<p>The following code skeleton shows how these components can be
organized:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_define</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">#--- add data definition code ---#</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">list_of_defs</span><span class="op">)</span> <span class="co"># list_of_defs is a list of simstudy data definitions</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">s_generate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">list_of_defs</span>, <span class="va">argsvec</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="va">list_of_defs</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">argsvec</span><span class="op">)</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#--- add data generation code ---#</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">generated_data</span><span class="op">)</span> <span class="co"># generated_data is a data.table</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">s_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">generated_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">#--- add model code ---#</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">model_results</span><span class="op">)</span> <span class="co"># model_results is a data.table</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">s_replicate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">argsvec</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">list_of_defs</span> <span class="op">&lt;-</span> <span class="fu">s_define</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">generated_data</span> <span class="op">&lt;-</span> <span class="fu">s_generate</span><span class="op">(</span><span class="va">list_of_defs</span>, <span class="va">argsvec</span><span class="op">)</span></span>
<span>  <span class="va">model_results</span> <span class="op">&lt;-</span> <span class="fu">s_model</span><span class="op">(</span><span class="va">generated_data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#--- add summary statistics code ---#</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">model_results</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">model_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="va">scenarios</span>, <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="fu">s_replicate</span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code>list2env</code> calls make all elements of the scenario
list available as variables inside the function environment. The
<em>scenarios</em> object is a list of parameter scenarios that are
being replicated. Replications can be managed using
<code>mclapply</code> in the <code>parallel</code> for speed, though
<code>lapply</code> or explicit loops work as well.</p>
</div>
<div class="section level2">
<h2 id="specifying-scenarios">Specifying scenarios<a class="anchor" aria-label="anchor" href="#specifying-scenarios"></a>
</h2>
<p>Simulation scenarios correspond to unique combinations of parameter
values used in data generation.</p>
<p>The simstudy function <code>scenario_list</code> automates the
creation of these combinations. It takes vectors of possible values and
returns a list of all combinations. For instance, if parameters
<em>a</em> and <em>b</em> each have two possible values,
scenario_list(a, b) returns four distinct scenarios. Scenarios can also
be grouped when certain parameters should vary together.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">18</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Independent parameters</span></span>
<span><span class="fu"><a href="../reference/scenario_list.html">scenario_list</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">##        a        b scenario </span></span>
<span><span class="co">##      0.5      8.0      1.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">##        a        b scenario </span></span>
<span><span class="co">##      0.7      8.0      2.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">##        a        b scenario </span></span>
<span><span class="co">##      0.9      8.0      3.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">##        a        b scenario </span></span>
<span><span class="co">##      0.5     16.0      4.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span>
<span><span class="co">##        a        b scenario </span></span>
<span><span class="co">##      0.7     16.0      5.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[6]]</span></span>
<span><span class="co">##        a        b scenario </span></span>
<span><span class="co">##      0.9     16.0      6.0</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Grouped parameters</span></span>
<span><span class="fu"><a href="../reference/scenario_list.html">scenario_list</a></span><span class="op">(</span><span class="va">a</span>, <span class="fu"><a href="../reference/grouped.html">grouped</a></span><span class="op">(</span><span class="va">b</span>, <span class="va">d</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">##        a        b        d scenario </span></span>
<span><span class="co">##      0.5      8.0     12.0      1.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">##        a        b        d scenario </span></span>
<span><span class="co">##      0.7      8.0     12.0      2.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">##        a        b        d scenario </span></span>
<span><span class="co">##      0.9      8.0     12.0      3.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">##        a        b        d scenario </span></span>
<span><span class="co">##      0.5     16.0     18.0      4.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span>
<span><span class="co">##        a        b        d scenario </span></span>
<span><span class="co">##      0.7     16.0     18.0      5.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[6]]</span></span>
<span><span class="co">##        a        b        d scenario </span></span>
<span><span class="co">##      0.9     16.0     18.0      6.0</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># With replications</span></span>
<span><span class="fu"><a href="../reference/scenario_list.html">scenario_list</a></span><span class="op">(</span><span class="va">b</span>, <span class="va">d</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">##        b        d scenario </span></span>
<span><span class="co">##        8       12        1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">##        b        d scenario </span></span>
<span><span class="co">##        8       12        1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">##        b        d scenario </span></span>
<span><span class="co">##       16       12        2 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">##        b        d scenario </span></span>
<span><span class="co">##       16       12        2 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span>
<span><span class="co">##        b        d scenario </span></span>
<span><span class="co">##        8       18        3 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[6]]</span></span>
<span><span class="co">##        b        d scenario </span></span>
<span><span class="co">##        8       18        3 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[7]]</span></span>
<span><span class="co">##        b        d scenario </span></span>
<span><span class="co">##       16       18        4 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[8]]</span></span>
<span><span class="co">##        b        d scenario </span></span>
<span><span class="co">##       16       18        4</span></span></code></pre>
<p>The full simulation process iterates over each scenario, running many
replications per combination. This can be done locally or distributed
using a high-performance computing framework such as
<code>slurmR</code>.</p>
</div>
<div class="section level2">
<h2 id="example-power-analysis-for-a-cluster-randomized-trial">Example: power analysis for a cluster-randomized trial<a class="anchor" aria-label="anchor" href="#example-power-analysis-for-a-cluster-randomized-trial"></a>
</h2>
<p>To illustrate the framework, consider a simple power analysis for a
cluster-randomized trial (CRT). The goal is to estimate how power
changes with sample size, between-site variance, and effect size.</p>
<p>We’ll fill in the skeleton functions to define and analyze the
simulated data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_define</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">#--- data definition code ---#</span></span>
<span>  </span>
<span>  <span class="va">def1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"site_eff"</span>, </span>
<span>    formula <span class="op">=</span> <span class="fl">0</span>, variance <span class="op">=</span> <span class="st">"..svar"</span>, dist <span class="op">=</span> <span class="st">"normal"</span>, id <span class="op">=</span> <span class="st">"site"</span><span class="op">)</span></span>
<span>  <span class="va">def1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def1</span>, <span class="st">"n"</span>, formula <span class="op">=</span> <span class="st">"..npat"</span>, dist <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">def2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defDataAdd.html">defDataAdd</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"Y"</span>, formula <span class="op">=</span> <span class="st">"5 + site_eff + ..delta * rx"</span>, </span>
<span>    variance <span class="op">=</span> <span class="st">"..ivar"</span>, dist <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>def1 <span class="op">=</span> <span class="va">def1</span>, def2 <span class="op">=</span> <span class="va">def2</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">s_generate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">list_of_defs</span>, <span class="va">argsvec</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="va">list_of_defs</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">argsvec</span><span class="op">)</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#--- data generation code ---#</span></span>
<span>  </span>
<span>  <span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">40</span>, <span class="va">def1</span><span class="op">)</span></span>
<span>  <span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trtAssign.html">trtAssign</a></span><span class="op">(</span><span class="va">ds</span>, grpName <span class="op">=</span> <span class="st">"rx"</span><span class="op">)</span></span>
<span>  <span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genCluster.html">genCluster</a></span><span class="op">(</span><span class="va">ds</span>, <span class="st">"site"</span>, <span class="st">"n"</span>, <span class="st">"id"</span><span class="op">)</span></span>
<span>  <span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addColumns.html">addColumns</a></span><span class="op">(</span><span class="va">def2</span>, <span class="va">dd</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dd</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">s_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">generated_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">#--- model code ---#</span></span>
<span>  </span>
<span>  <span class="va">lmefit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">site</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">generated_data</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="fu">tidy</span><span class="op">(</span><span class="va">lmefit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">s_replicate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">argsvec</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">list_of_defs</span> <span class="op">&lt;-</span> <span class="fu">s_define</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">generated_data</span> <span class="op">&lt;-</span> <span class="fu">s_generate</span><span class="op">(</span><span class="va">list_of_defs</span>, <span class="va">argsvec</span><span class="op">)</span></span>
<span>  <span class="va">model_results</span> <span class="op">&lt;-</span> <span class="fu">s_model</span><span class="op">(</span><span class="va">generated_data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">argsvec</span>, <span class="va">model_results</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p>The four parameters—<em>npat</em> (2 values), <em>svar</em> (2
values), <em>ivar</em> (2 values), and <em>delta</em> (3 values)—are
specified as vectors. Because the variance parameters are meant to be
tested together, they are grouped. This results in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>×</mo><mn>2</mn><mo>×</mo><mn>3</mn><mo>=</mo><mn>18</mn></mrow><annotation encoding="application/x-tex">3 \times 2 \times 3 = 18</annotation></semantics></math>
distinct scenarios. With 1000 replications per scenario, the
<em>scenarios</em> list contains 18,000 objects. The object
<em>model_fits</em> will then store the model estimates for each
replication:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#------ set simulation parameters</span></span>
<span></span>
<span><span class="va">npat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">16</span>, <span class="fl">24</span><span class="op">)</span></span>
<span><span class="va">svar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.40</span>, <span class="fl">0.80</span><span class="op">)</span></span>
<span><span class="va">ivar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">1.00</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scenario_list.html">scenario_list</a></span><span class="op">(</span><span class="va">delta</span>, <span class="va">npat</span>, <span class="fu"><a href="../reference/grouped.html">grouped</a></span><span class="op">(</span><span class="va">svar</span>, <span class="va">ivar</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="va">scenarios</span>, <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="fu">s_replicate</span><span class="op">(</span><span class="va">a</span><span class="op">)</span>, mc.cores <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>Once the data have been collected, it is quite easy to summarize and
create a table or a figure.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summarize</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m_fit</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">m_fit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">reject</span> <span class="op">&lt;-</span> <span class="va">m_fit</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">term</span> <span class="op">==</span> <span class="st">"rx"</span>, <span class="va">p.value</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">args</span>, <span class="va">reject</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">reject</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">model_fits</span>, <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="fu">summarize</span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">power</span> <span class="op">&lt;-</span> <span class="va">reject</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">reject</span><span class="op">)</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">delta</span>, <span class="va">npat</span>, <span class="va">svar</span>, <span class="va">ivar</span>, <span class="va">scenario</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p><img src="framework_files/figure-html/power_plot-1.png" class="r-plt" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://www.rdatagen.net/" class="external-link">Keith Goldfeld</a>, Jacob Wujciak-Jens.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

      </footer>
</div>






  </body>
</html>
