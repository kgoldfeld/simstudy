<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clustered Data • simstudy</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Clustered Data">
<meta property="og:description" content="simstudy">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simstudy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/simstudy.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/clustered.html">Clustered Data</a>
    </li>
    <li>
      <a href="../articles/correlated.html">Correlated Data</a>
    </li>
    <li>
      <a href="../articles/double_dot_extension.html">Dynamic Data Definition</a>
    </li>
    <li>
      <a href="../articles/longitudinal.html">Longitudinal Data</a>
    </li>
    <li>
      <a href="../articles/missing.html">Missing Data</a>
    </li>
    <li>
      <a href="../articles/ordinal.html">Ordinal Categorical Data</a>
    </li>
    <li>
      <a href="../articles/spline.html">Spline Data</a>
    </li>
    <li>
      <a href="../articles/survival.html">Survival Data</a>
    </li>
    <li>
      <a href="../articles/treat_and_exposure.html">Treatment and Exposure</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kgoldfeld/simstudy/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="clustered_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Clustered Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kgoldfeld/simstudy/blob/master/vignettes/clustered.Rmd"><code>vignettes/clustered.Rmd</code></a></small>
      <div class="hidden name"><code>clustered.Rmd</code></div>

    </div>

    
    
<p>The function <code>genCluster</code> generates multilevel or clustered data based on a previously generated data set that is one “level” up from the clustered data. For example, if there is a data set that contains school level (considered here to be level 2), classrooms (level 1) can be generated. And then, students (now level 1) can be generated within classrooms (now level 2)</p>
<p>In the example here, we do in fact generate school, class, and student level data. There are eight schools, four of which are randomized to receive an intervention. The number of classes per school varies, as does the number of students per class. (It is straightforward to generate fully balanced data by using constant values.) The outcome of interest is a test score, which is influenced by gender and the intervention. In addition, test scores vary by schools, and by classrooms, so the simulation provides <em>random effects</em> at each of these levels.</p>
<p>We start by defining the school level data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="va">gen.school</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"s0"</span>, dist <span class="op">=</span> <span class="st">"normal"</span>, formula <span class="op">=</span> <span class="fl">0</span>, variance <span class="op">=</span> <span class="fl">3</span>, 
    id <span class="op">=</span> <span class="st">"idSchool"</span><span class="op">)</span>
<span class="va">gen.school</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">gen.school</span>, varname <span class="op">=</span> <span class="st">"nClasses"</span>, dist <span class="op">=</span> <span class="st">"noZeroPoisson"</span>, formula <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="va">dtSchool</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">8</span>, <span class="va">gen.school</span><span class="op">)</span>
<span class="va">dtSchool</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trtAssign.html">trtAssign</a></span><span class="op">(</span><span class="va">dtSchool</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">dtSchool</span></pre></div>
<pre><code>##    idSchool         s0 nClasses trtGrp
## 1:        1  0.6898157        4      0
## 2:        2 -1.5647994        2      0
## 3:        3 -1.0299606        1      1
## 4:        4 -0.8310315        6      0
## 5:        5  0.8465787        3      1
## 6:        6  0.7018579        1      0
## 7:        7 -1.2211891        6      1
## 8:        8  2.2425512        3      1</code></pre>
<p>The classroom level data are generated with a call to <code>genCluster</code>, and then school level data is added by a call to <code>addColumns</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">gen.class</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defDataAdd.html">defDataAdd</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"c0"</span>, dist <span class="op">=</span> <span class="st">"normal"</span>, formula <span class="op">=</span> <span class="fl">0</span>, variance <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">gen.class</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defDataAdd.html">defDataAdd</a></span><span class="op">(</span><span class="va">gen.class</span>, varname <span class="op">=</span> <span class="st">"nStudents"</span>, dist <span class="op">=</span> <span class="st">"noZeroPoisson"</span>, 
    formula <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>

<span class="va">dtClass</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genCluster.html">genCluster</a></span><span class="op">(</span><span class="va">dtSchool</span>, <span class="st">"idSchool"</span>, numIndsVar <span class="op">=</span> <span class="st">"nClasses"</span>, level1ID <span class="op">=</span> <span class="st">"idClass"</span><span class="op">)</span>
<span class="va">dtClass</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addColumns.html">addColumns</a></span><span class="op">(</span><span class="va">gen.class</span>, <span class="va">dtClass</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dtClass</span>, <span class="fl">10</span><span class="op">)</span></pre></div>
<pre><code>##     idSchool         s0 nClasses trtGrp idClass         c0 nStudents
##  1:        1  0.6898157        4      0       1  0.6704555        14
##  2:        1  0.6898157        4      0       2 -2.8224104        31
##  3:        1  0.6898157        4      0       3 -2.0754965        14
##  4:        1  0.6898157        4      0       4  0.4692055        24
##  5:        2 -1.5647994        2      0       5 -4.3093833        12
##  6:        2 -1.5647994        2      0       6  2.1724020        19
##  7:        3 -1.0299606        1      1       7  0.8861061        20
##  8:        4 -0.8310315        6      0       8 -3.4272460        28
##  9:        4 -0.8310315        6      0       9  1.3299529        19
## 10:        4 -0.8310315        6      0      10 -1.1168601        22</code></pre>
<p>Finally, the student level data are added using the same process:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">gen.student</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defDataAdd.html">defDataAdd</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"Male"</span>, dist <span class="op">=</span> <span class="st">"binary"</span>, 
    formula <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="va">gen.student</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defDataAdd.html">defDataAdd</a></span><span class="op">(</span><span class="va">gen.student</span>, varname <span class="op">=</span> <span class="st">"age"</span>, dist <span class="op">=</span> <span class="st">"uniform"</span>, 
    formula <span class="op">=</span> <span class="st">"9.5; 10.5"</span><span class="op">)</span>
<span class="va">gen.student</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defDataAdd.html">defDataAdd</a></span><span class="op">(</span><span class="va">gen.student</span>, varname <span class="op">=</span> <span class="st">"test"</span>, dist <span class="op">=</span> <span class="st">"normal"</span>, 
    formula <span class="op">=</span> <span class="st">"50 - 5*Male + s0 + c0 + 8 * trtGrp"</span>, variance <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">dtStudent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genCluster.html">genCluster</a></span><span class="op">(</span><span class="va">dtClass</span>, cLevelVar <span class="op">=</span> <span class="st">"idClass"</span>, numIndsVar <span class="op">=</span> <span class="st">"nStudents"</span>, 
    level1ID <span class="op">=</span> <span class="st">"idChild"</span><span class="op">)</span>

<span class="va">dtStudent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addColumns.html">addColumns</a></span><span class="op">(</span><span class="va">gen.student</span>, <span class="va">dtStudent</span><span class="op">)</span></pre></div>
<p>This is what the clustered data look like. Each classroom is represented by a box, and each school is represented by a color. The intervention group is highlighted by dark outlines:</p>
<p><img src="clustered_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.rdatagen.net/">Keith Goldfeld</a>, Jacob Wujciak-Jens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
