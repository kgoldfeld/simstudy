<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Treatment and Exposure • simstudy</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Treatment and Exposure">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simstudy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/simstudy.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/clustered.html">Clustered Data</a>
    </li>
    <li>
      <a href="../articles/corelationmat.html">Correlation Matrices</a>
    </li>
    <li>
      <a href="../articles/correlated.html">Correlated Data</a>
    </li>
    <li>
      <a href="../articles/customdist.html">Customized Distributions</a>
    </li>
    <li>
      <a href="../articles/double_dot_extension.html">Dynamic Data Definition</a>
    </li>
    <li>
      <a href="../articles/framework.html">Framework for repeated simulations</a>
    </li>
    <li>
      <a href="../articles/logisticCoefs.html">Targeted logistic model coefficients</a>
    </li>
    <li>
      <a href="../articles/longitudinal.html">Longitudinal Data</a>
    </li>
    <li>
      <a href="../articles/missing.html">Missing Data</a>
    </li>
    <li>
      <a href="../articles/ordinal.html">Ordinal Categorical Data</a>
    </li>
    <li>
      <a href="../articles/spline.html">Spline Data</a>
    </li>
    <li>
      <a href="../articles/survival.html">Survival Data</a>
    </li>
    <li>
      <a href="../articles/treat_and_exposure.html">Treatment and Exposure</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kgoldfeld/simstudy/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Treatment and Exposure</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kgoldfeld/simstudy/blob/main/vignettes/treat_and_exposure.Rmd" class="external-link"><code>vignettes/treat_and_exposure.Rmd</code></a></small>
      <div class="hidden name"><code>treat_and_exposure.Rmd</code></div>

    </div>

    
    
<p>Treatment assignment can be accomplished through the original data
generation process, using <code>defData</code> and <code>genData</code>.
However, the functions <code>trtAssign</code> and
<code>trtObserve</code> provide more options to generate treatment
assignment.</p>
<div class="section level2">
<h2 id="assigned-treatment">Assigned treatment<a class="anchor" aria-label="anchor" href="#assigned-treatment"></a>
</h2>
<p>Treatment assignment can simulate how the treatment allocation is
made in a randomized study. Assignment to treatment groups can be (close
to) balanced (as would occur in a block randomized trial); this
balancing can be done without or without strata. Alternatively, the
assignment can be left to chance without blocking; in this case, balance
across treatment groups is not guaranteed, particularly with small
sample sizes.</p>
<p>First, create the data definition:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"male"</span>, dist <span class="op">=</span> <span class="st">"binary"</span>, </span>
<span>               formula <span class="op">=</span> <span class="fl">.5</span> , id<span class="op">=</span><span class="st">"cid"</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"over65"</span>, dist <span class="op">=</span> <span class="st">"binary"</span>, </span>
<span>               formula <span class="op">=</span> <span class="st">"-1.7 + .8*male"</span>, link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"baseDBP"</span>, dist <span class="op">=</span> <span class="st">"normal"</span>, </span>
<span>               formula <span class="op">=</span> <span class="fl">70</span>, variance <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtstudy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">330</span>, <span class="va">def</span><span class="op">)</span></span></code></pre></div>
<p><em>Balanced treatment assignment, stratified by gender and age
category (not blood pressure)</em></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">study1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trtAssign.html">trtAssign</a></span><span class="op">(</span><span class="va">dtstudy</span>, n <span class="op">=</span> <span class="fl">3</span>, balanced <span class="op">=</span> <span class="cn">TRUE</span>, strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"over65"</span><span class="op">)</span>,</span>
<span>    grpName <span class="op">=</span> <span class="st">"rxGrp"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">study1</span></span></code></pre></div>
<pre><code><span><span class="co">## Key: &lt;cid&gt;</span></span>
<span><span class="co">##        cid  male over65  baseDBP rxGrp</span></span>
<span><span class="co">##      &lt;int&gt; &lt;int&gt;  &lt;int&gt;    &lt;num&gt; &lt;int&gt;</span></span>
<span><span class="co">##   1:     1     0      0 76.65442     2</span></span>
<span><span class="co">##   2:     2     1      0 57.48019     2</span></span>
<span><span class="co">##   3:     3     1      0 77.64250     3</span></span>
<span><span class="co">##   4:     4     0      0 68.92938     2</span></span>
<span><span class="co">##   5:     5     0      0 71.86593     3</span></span>
<span><span class="co">##  ---                                  </span></span>
<span><span class="co">## 326:   326     0      0 74.55486     2</span></span>
<span><span class="co">## 327:   327     1      0 66.13541     1</span></span>
<span><span class="co">## 328:   328     1      0 62.99926     3</span></span>
<span><span class="co">## 329:   329     0      0 73.38239     2</span></span>
<span><span class="co">## 330:   330     1      1 74.65530     3</span></span></code></pre>
<p><em>Balanced treatment assignment (without stratification)</em></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">study2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trtAssign.html">trtAssign</a></span><span class="op">(</span><span class="va">dtstudy</span>, n <span class="op">=</span> <span class="fl">3</span>, balanced <span class="op">=</span> <span class="cn">TRUE</span>, grpName <span class="op">=</span> <span class="st">"rxGrp"</span><span class="op">)</span></span></code></pre></div>
<p><em>Random (unbalanced) treatment assignment</em></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">study3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trtAssign.html">trtAssign</a></span><span class="op">(</span><span class="va">dtstudy</span>, n <span class="op">=</span> <span class="fl">3</span>, balanced <span class="op">=</span> <span class="cn">FALSE</span>, grpName <span class="op">=</span> <span class="st">"rxGrp"</span><span class="op">)</span></span></code></pre></div>
<p><em>Comparison of three treatment assignment mechanisms</em>
<img src="treat_and_exposure_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" width="384"></p>
</div>
<div class="section level2">
<h2 id="assigned-treatment-using-trtassign-distribution-in-defdata">Assigned treatment using <em>trtAssign</em> distribution in
<code>defData</code><a class="anchor" aria-label="anchor" href="#assigned-treatment-using-trtassign-distribution-in-defdata"></a>
</h2>
<p>It is also possible to generate treatment assignments directly in the
<code>defData</code> and <code>genData</code> process. In this example,
randomization is stratified by <em>gender</em> and <em>age</em>, and the
outcome <em>y</em> is effected by both of these factors as well as the
treatment assignment variable <em>rx</em>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"male"</span>, dist <span class="op">=</span> <span class="st">"binary"</span>, </span>
<span>               formula <span class="op">=</span> <span class="fl">.5</span> , id<span class="op">=</span><span class="st">"cid"</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"over65"</span>, dist <span class="op">=</span> <span class="st">"binary"</span>,  </span>
<span>               formula <span class="op">=</span> <span class="st">"-1.7 + .8*male"</span>, link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"rx"</span>, dist <span class="op">=</span> <span class="st">"trtAssign"</span>,</span>
<span>               formula <span class="op">=</span> <span class="st">"1;1"</span>, variance <span class="op">=</span> <span class="st">"male;over65"</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"y"</span>, dist <span class="op">=</span> <span class="st">"normal"</span>, </span>
<span>               formula <span class="op">=</span> <span class="st">"20 + 5*male + 10*over65 + 10*rx"</span>, variance <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtstudy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">330</span>, <span class="va">def</span><span class="op">)</span></span>
<span><span class="va">dtstudy</span></span></code></pre></div>
<pre><code><span><span class="co">## Key: &lt;cid&gt;</span></span>
<span><span class="co">##        cid  male over65    rx        y</span></span>
<span><span class="co">##      &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;    &lt;num&gt;</span></span>
<span><span class="co">##   1:     1     1      0     1 36.60755</span></span>
<span><span class="co">##   2:     2     0      0     1 38.47782</span></span>
<span><span class="co">##   3:     3     0      1     0 29.28461</span></span>
<span><span class="co">##   4:     4     0      0     1 31.91919</span></span>
<span><span class="co">##   5:     5     0      0     0 24.67497</span></span>
<span><span class="co">##  ---                                  </span></span>
<span><span class="co">## 326:   326     0      0     1 28.90395</span></span>
<span><span class="co">## 327:   327     0      0     1 28.15482</span></span>
<span><span class="co">## 328:   328     1      0     0 39.20918</span></span>
<span><span class="co">## 329:   329     1      0     0 27.34701</span></span>
<span><span class="co">## 330:   330     1      0     0 32.81881</span></span></code></pre>
<p>Here are the counts and average outcomes for each <em>gender</em>,
<em>age</em>, and <em>treatment</em> combination:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtstudy</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>n <span class="op">=</span> <span class="va">.N</span>, avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">male</span>, <span class="va">over65</span>, <span class="va">rx</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Key: &lt;male, over65, rx&gt;</span></span>
<span><span class="co">##     male over65    rx     n   avg</span></span>
<span><span class="co">##    &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt;</span></span>
<span><span class="co">## 1:     0      0     0    65  20.8</span></span>
<span><span class="co">## 2:     0      0     1    66  30.9</span></span>
<span><span class="co">## 3:     0      1     0    14  31.7</span></span>
<span><span class="co">## 4:     0      1     1    14  38.2</span></span>
<span><span class="co">## 5:     1      0     0    69  25.9</span></span>
<span><span class="co">## 6:     1      0     1    68  35.4</span></span>
<span><span class="co">## 7:     1      1     0    17  32.6</span></span>
<span><span class="co">## 8:     1      1     1    17  45.6</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="observed-treatment">Observed treatment<a class="anchor" aria-label="anchor" href="#observed-treatment"></a>
</h2>
<p>If exposure or treatment is observed (rather than randomly assigned),
use <code>trtObserved</code> to generate groups. There may be any number
of possible exposure or treatment groups, and the probability of
exposure to a specific level can depend on covariates already in the
data set. In this case, there are three exposure groups that vary by
gender and age:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-2 + 2*male - .5*over65"</span>, <span class="st">"-1 + 2*male + .5*over65"</span><span class="op">)</span></span>
<span><span class="va">dtExp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trtObserve.html">trtObserve</a></span><span class="op">(</span><span class="va">dtstudy</span>, formulas <span class="op">=</span> <span class="va">formula1</span>, logit.link <span class="op">=</span> <span class="cn">TRUE</span>, grpName <span class="op">=</span> <span class="st">"exposure"</span><span class="op">)</span></span></code></pre></div>
<p>Here are the exposure distributions by gender and age:</p>
<p><img src="treat_and_exposure_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" width="624"></p>
<p>Here is a second case of three exposures where the exposure is
independent of any covariates. Note that specifying the formula as
<code>c(.35, .45)</code> is the same as specifying it is
<code>c(.35, .45, .20)</code>. Also, when referring to probabilities,
the identity link is used:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">0.45</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtExp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trtObserve.html">trtObserve</a></span><span class="op">(</span><span class="va">dtstudy</span>, formulas <span class="op">=</span> <span class="va">formula2</span>, logit.link <span class="op">=</span> <span class="cn">FALSE</span>, grpName <span class="op">=</span> <span class="st">"exposure"</span><span class="op">)</span></span></code></pre></div>
<p><img src="treat_and_exposure_files/figure-html/unnamed-chunk-12-1.png" class="r-plt" width="624"></p>
</div>
<div class="section level2">
<h2 id="stepped-wedge-design">Stepped-wedge design<a class="anchor" aria-label="anchor" href="#stepped-wedge-design"></a>
</h2>
<p>Stepped-wedge designs are a special class of cluster randomized
trials where each cluster is observed in both treatment arms (as opposed
to the classic parallel design where only some of the clusters receive
the treatment). This is a special case of a cross-over design, where the
cross-over is only in one direction: control (or pre-intervention) to
intervention.</p>
<p>In this example, the data generating process looks like this:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mrow><mi>i</mi><mi>c</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>b</mi><mi>c</mi></msub><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><mo>*</mo><mi>t</mi><mo>+</mo><msub><mi>β</mi><mn>2</mn></msub><mo>*</mo><msub><mi>X</mi><mrow><mi>c</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>e</mi><mrow><mi>i</mi><mi>c</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Y_{ict} = \beta_0 + b_c + \beta_1 * t + \beta_2*X_{ct} + e_{ict}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mrow><mi>i</mi><mi>c</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">Y_{ict}</annotation></semantics></math>
is the outcome for individual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
in cluster
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>
in time period
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>c</mi></msub><annotation encoding="application/x-tex">b_c</annotation></semantics></math>
is a cluster-specific effect,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mi>c</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">X_{ct}</annotation></semantics></math>
is the intervention indicator that has a value 1 during periods where
the cluster is under the intervention, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>e</mi><mrow><mi>i</mi><mi>c</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">e_{ict}</annotation></semantics></math>
is the individual-level effect. Both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>c</mi></msub><annotation encoding="application/x-tex">b_c</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>e</mi><mrow><mi>i</mi><mi>c</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">e_{ict}</annotation></semantics></math>
are normally distributed with mean 0 and variances
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>b</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma^2_{b}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>e</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma^2_{e}</annotation></semantics></math>,
respectively.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\beta_1</annotation></semantics></math>
is the time trend, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>2</mn></msub><annotation encoding="application/x-tex">\beta_2</annotation></semantics></math>
is the intervention effect.</p>
<p>We need to define the cluster-level variables (i.e. the cluster
effect and the cluster size) as well as the individual specific outcome.
In this case each cluster will have 15 individuals per period, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mi>b</mi><mn>2</mn></msubsup><mo>=</mo><mn>0.20</mn></mrow><annotation encoding="application/x-tex">\sigma^2_b = 0.20</annotation></semantics></math>.
In addition,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mi>e</mi><mn>2</mn></msubsup><mo>=</mo><mn>1.75</mn></mrow><annotation encoding="application/x-tex">\sigma^2_e = 1.75</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kgoldfeld/simstudy" class="external-link">simstudy</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">defc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"ceffect"</span>, formula <span class="op">=</span> <span class="fl">0</span>, variance <span class="op">=</span> <span class="fl">0.20</span>, </span>
<span>                dist <span class="op">=</span> <span class="st">"normal"</span>, id <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span>
<span><span class="va">defc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">defc</span>, <span class="st">"m"</span>, formula <span class="op">=</span> <span class="fl">15</span>, dist <span class="op">=</span> <span class="st">"nonrandom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">defa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defDataAdd.html">defDataAdd</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"Y"</span>, </span>
<span>                   formula <span class="op">=</span> <span class="st">"0 + ceffect + 0.1*period + trt*1.5"</span>, </span>
<span>                   variance <span class="op">=</span> <span class="fl">1.75</span>, dist <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span></code></pre></div>
<p>In this case, there will be 30 clusters and 24 time periods. With 15
individuals per cluster per period, there will be 360 observations for
each cluster, and 10,800 in total. (There is no reason the cluster sizes
need to be deterministic, but I just did that to simplify things a
bit.)</p>
<p>Cluster-level intervention assignment is done after generating the
cluster-level and time-period data. The call to
<code>trtStepWedge</code> includes 3 key arguments that specify the
number of waves, the length of each wave, and the period during which
the first clusters begin the intervention.</p>
<p><code>nWaves</code> indicates how many clusters share the same
starting period for the intervention. In this case, we have 5 waves,
with 6 clusters each. <code>startPer</code> is the first period of the
first wave. The earliest starting period is 0, the first period. Here,
the first wave starts the intervention during period 4.
<code>lenWaves</code> indicates the length between starting points for
each wave. Here, a length of 4 means that the starting points will be 4,
8, 12, 16, and 20.</p>
<p>Once the treatment assignments are made, the individual records are
created and the outcome data are generated in the last step.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">608477</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">30</span>, <span class="va">defc</span><span class="op">)</span></span>
<span><span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addPeriods.html">addPeriods</a></span><span class="op">(</span><span class="va">dc</span>, <span class="fl">24</span>, <span class="st">"cluster"</span>, timevarName <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span></span>
<span><span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trtStepWedge.html">trtStepWedge</a></span><span class="op">(</span><span class="va">dp</span>, <span class="st">"cluster"</span>, nWaves <span class="op">=</span> <span class="fl">5</span>, lenWaves <span class="op">=</span> <span class="fl">4</span>, </span>
<span>          startPer <span class="op">=</span> <span class="fl">4</span>, grpName <span class="op">=</span> <span class="st">"trt"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genCluster.html">genCluster</a></span><span class="op">(</span><span class="va">dp</span>, cLevelVar <span class="op">=</span> <span class="st">"timeID"</span>, <span class="st">"m"</span>, <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addColumns.html">addColumns</a></span><span class="op">(</span><span class="va">defa</span>, <span class="va">dd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dd</span></span></code></pre></div>
<pre><code><span><span class="co">## Key: &lt;id&gt;</span></span>
<span><span class="co">##        cluster timeID period     ceffect     m startTrt   trt    id          Y</span></span>
<span><span class="co">##          &lt;int&gt;  &lt;int&gt;  &lt;int&gt;       &lt;num&gt; &lt;num&gt;    &lt;num&gt; &lt;num&gt; &lt;int&gt;      &lt;num&gt;</span></span>
<span><span class="co">##     1:       1      1      0  0.62775229    15        4     0     1  1.5236098</span></span>
<span><span class="co">##     2:       1      1      0  0.62775229    15        4     0     2  0.9863920</span></span>
<span><span class="co">##     3:       1      1      0  0.62775229    15        4     0     3 -0.1232112</span></span>
<span><span class="co">##     4:       1      1      0  0.62775229    15        4     0     4  2.0901759</span></span>
<span><span class="co">##     5:       1      1      0  0.62775229    15        4     0     5 -2.3404034</span></span>
<span><span class="co">##    ---                                                                        </span></span>
<span><span class="co">## 10796:      30    720     23 -0.09828129    15       20     1 10796  1.9167998</span></span>
<span><span class="co">## 10797:      30    720     23 -0.09828129    15       20     1 10797  5.9206722</span></span>
<span><span class="co">## 10798:      30    720     23 -0.09828129    15       20     1 10798  4.1182178</span></span>
<span><span class="co">## 10799:      30    720     23 -0.09828129    15       20     1 10799  4.5691583</span></span>
<span><span class="co">## 10800:      30    720     23 -0.09828129    15       20     1 10800  3.6557608</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dSum</span> <span class="op">&lt;-</span> <span class="va">dd</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">cluster</span>, <span class="va">period</span>, <span class="va">trt</span>, <span class="va">startTrt</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dSum</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">period</span>, y <span class="op">=</span> <span class="va">Y</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">cluster</span>, <span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">startTrt</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">:</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">23</span>, by <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#b8cce4"</span>, <span class="st">"#4e81ba"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="treat_and_exposure_files/figure-html/unnamed-chunk-15-1.png" class="r-plt" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://www.rdatagen.net/" class="external-link">Keith Goldfeld</a>, Jacob Wujciak-Jens.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

      </footer>
</div>






  </body>
</html>
