<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulating Study Data • simstudy</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulating Study Data">
<meta property="og:description" content="simstudy">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simstudy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/simstudy.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/clustered.html">Clustered Data</a>
    </li>
    <li>
      <a href="../articles/corelationmat.html">Correlation Matrices</a>
    </li>
    <li>
      <a href="../articles/correlated.html">Correlated Data</a>
    </li>
    <li>
      <a href="../articles/double_dot_extension.html">Dynamic Data Definition</a>
    </li>
    <li>
      <a href="../articles/logisticCoefs.html">Targeted logistic model coefficients</a>
    </li>
    <li>
      <a href="../articles/longitudinal.html">Longitudinal Data</a>
    </li>
    <li>
      <a href="../articles/missing.html">Missing Data</a>
    </li>
    <li>
      <a href="../articles/ordinal.html">Ordinal Categorical Data</a>
    </li>
    <li>
      <a href="../articles/spline.html">Spline Data</a>
    </li>
    <li>
      <a href="../articles/survival.html">Survival Data</a>
    </li>
    <li>
      <a href="../articles/treat_and_exposure.html">Treatment and Exposure</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kgoldfeld/simstudy/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulating Study Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kgoldfeld/simstudy/blob/HEAD/vignettes/simstudy.Rmd" class="external-link"><code>vignettes/simstudy.Rmd</code></a></small>
      <div class="hidden name"><code>simstudy.Rmd</code></div>

    </div>

    
    
<p>The <code>simstudy</code> package is a collection of functions that
allows users to generate simulated data sets to explore modeling
techniques or better understand data generating processes. The user
defines the distributions of individual variables, specifies
relationships between covariates and outcomes, and generates data based
on these specifications. The final data sets can represent randomized
control trials, repeated measure designs, cluster-randomized trials, or
naturally observed data processes. Other complexities that can be added
include survival data, correlated data, factorial study designs, step
wedge designs, and missing data processes.</p>
<p>Simulation using <code>simstudy</code> has two fundamental steps. The
user (1) <strong>defines</strong> the data elements of a data set and
(2) <strong>generates</strong> the data based on these definitions.
Additional functionality exists to simulate observed or randomized
<strong>treatment assignment/exposures</strong>, to create
<strong>longitudinal/panel</strong> data, to create
<strong>multi-level/hierarchical</strong> data, to create data sets with
<strong>correlated variables</strong> based on a specified covariance
structure, to <strong>merge</strong> data sets, to create data sets with
<strong>missing</strong> data, and to create non-linear relationships
with underlying <strong>spline</strong> curves.</p>
<p>The overarching philosophy of <code>simstudy</code> is to create data
generating processes that mimic the typical models used to fit those
types of data. So, the parameterization of some of the data generating
processes may not follow the standard parameterizations for the specific
distributions. For example, in <code>simstudy</code>
<em>gamma</em>-distributed data are generated based on the specification
of a mean <span class="math inline">\(\mu\)</span> (or <span class="math inline">\(\log(\mu)\)</span>) and a dispersion <span class="math inline">\(d\)</span>, rather than shape <span class="math inline">\(\alpha\)</span> and rate <span class="math inline">\(\beta\)</span> parameters that more typically
characterize the <em>gamma</em> distribution. When we estimate the
parameters, we are modeling <span class="math inline">\(\mu\)</span> (or
some function of <span class="math inline">\((\mu)\)</span>), so we
should explicitly recover the <code>simstudy</code> parameters used to
generate the model - illuminating the relationship between the
underlying data generating processes and the models.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This introduction provides a brief overview to the basics of defining
and generating data, including treatment or exposure variables.
Subsequent sections in this vignette provide more details on these
processes. For information on more elaborate data generating mechanisms,
please refer to other vignettes in this package that provide more
detailed descriptions.</p>
<div class="section level3">
<h3 id="defining-the-data">Defining the Data<a class="anchor" aria-label="anchor" href="#defining-the-data"></a>
</h3>
<p>The key to simulating data in <code>simstudy</code> is the creation
of a series of data definition tables that look like this:</p>
<table class="table">
<thead><tr class="header">
<th align="left">varname</th>
<th align="left">formula</th>
<th align="right">variance</th>
<th align="left">dist</th>
<th align="left">link</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="left">10</td>
<td align="right">2</td>
<td align="left">normal</td>
<td align="left">identity</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="left">-2 + age * 0.1</td>
<td align="right">0</td>
<td align="left">binary</td>
<td align="left">logit</td>
</tr>
<tr class="odd">
<td align="left">visits</td>
<td align="left">1.5 - 0.2 * age + 0.5 * female</td>
<td align="right">0</td>
<td align="left">poisson</td>
<td align="left">log</td>
</tr>
</tbody>
</table>
<p>These definition tables can be generated in two ways. One option is
to use any external editor that allows the creation of .csv files, which
can be read in with a call to <code>defRead</code>. An alternative is to
make repeated calls to the function <code>defData</code>. This script
builds a definition table internally:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"age"</span>, dist <span class="op">=</span> <span class="st">"normal"</span>, formula <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    variance <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"female"</span>, dist <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>    formula <span class="op">=</span> <span class="st">"-2 + age * 0.1"</span>, link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"visits"</span>, dist <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>    formula <span class="op">=</span> <span class="st">"1.5 - 0.2 * age + 0.5 * female"</span>, link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span></code></pre></div>
<p>The data definition table includes a row for each variable that is to
be generated, and has the following fields: <code>varname*</code>,
<code>formula</code>, <code>variance</code>, <code>dist</code>, and
<code>link</code>. <code>varname</code> provides the name of the
variable to be generated. <code>formula</code> is either a value or
string representing any valid R formula (which can include function
calls) that in most cases defines the mean of the distribution.
<code>variance</code> is a value or string that specifies either the
variance or other parameter that characterizes the distribution; the
default is 0. <code>dist</code> is defines the distribution of the
variable to be generated; the default is <em>normal</em>. The
<code>link</code> is a function that defines the relationship of the
formula with the mean value, and can either <em>identity</em>,
<em>log</em>, or <em>logit</em>, depending on the distribution; the
default is <em>identity</em>.</p>
<p>If using <code>defData</code> to create the definition table, the
first call to <code>defData</code> without specifying a definition name
(in this example the definition name is <em>def</em>) creates a
<strong>new</strong> data.table with a single row. An additional row is
added to the table <code>def</code> each time the function
<code>defData</code> is called. Each of these calls is the definition of
a new field in the data set that will be generated.</p>
</div>
<div class="section level3">
<h3 id="generating-the-data">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data"></a>
</h3>
<p>After the data set definitions have been created, a new data set with
<span class="math inline">\(n\)</span> observations can be created with
a call to function <strong><code>genData</code></strong>. In this
example, 1,000 observations are generated using the data set definitions
in <strong><code>def</code></strong>, and then stored in the object
<strong><code>dd</code></strong>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">87261</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="va">def</span><span class="op">)</span></span>
<span><span class="va">dd</span></span></code></pre></div>
<pre><code><span><span class="co">##         id   age female visits</span></span>
<span><span class="co">##    1:    1  9.78      0      0</span></span>
<span><span class="co">##    2:    2 10.81      0      0</span></span>
<span><span class="co">##    3:    3  8.86      0      1</span></span>
<span><span class="co">##    4:    4  9.83      1      1</span></span>
<span><span class="co">##    5:    5 10.58      0      0</span></span>
<span><span class="co">##   ---                         </span></span>
<span><span class="co">##  996:  996  8.87      1      2</span></span>
<span><span class="co">##  997:  997 10.27      0      0</span></span>
<span><span class="co">##  998:  998  6.84      0      1</span></span>
<span><span class="co">##  999:  999  9.28      0      2</span></span>
<span><span class="co">## 1000: 1000 10.80      1      2</span></span></code></pre>
<p>If no data definition is provided, a simple data set is created with
just id’s.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         id</span></span>
<span><span class="co">##    1:    1</span></span>
<span><span class="co">##    2:    2</span></span>
<span><span class="co">##    3:    3</span></span>
<span><span class="co">##    4:    4</span></span>
<span><span class="co">##    5:    5</span></span>
<span><span class="co">##   ---     </span></span>
<span><span class="co">##  996:  996</span></span>
<span><span class="co">##  997:  997</span></span>
<span><span class="co">##  998:  998</span></span>
<span><span class="co">##  999:  999</span></span>
<span><span class="co">## 1000: 1000</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="assigning-treatmentexposure">Assigning treatment/exposure<a class="anchor" aria-label="anchor" href="#assigning-treatmentexposure"></a>
</h3>
<p>In many instances, the data generation process will involve a
treatment or exposure. While it is possible to generate a treatment or
exposure variable directly using the data definition process,
<code>trtAssign</code> and <code>trtObserve</code> offer the ability to
generate more involved types of study designs. In particular, with
<code>trtAssign</code>, balanced and stratified designs are
possible.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">study1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trtAssign.html">trtAssign</a></span><span class="op">(</span><span class="va">dd</span>, n <span class="op">=</span> <span class="fl">3</span>, balanced <span class="op">=</span> <span class="cn">TRUE</span>, strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female"</span><span class="op">)</span>,</span>
<span>    grpName <span class="op">=</span> <span class="st">"rx"</span><span class="op">)</span></span>
<span><span class="va">study1</span></span></code></pre></div>
<pre><code><span><span class="co">##         id   age female visits rx</span></span>
<span><span class="co">##    1:    1  9.78      0      0  3</span></span>
<span><span class="co">##    2:    2 10.81      0      0  1</span></span>
<span><span class="co">##    3:    3  8.86      0      1  3</span></span>
<span><span class="co">##    4:    4  9.83      1      1  3</span></span>
<span><span class="co">##    5:    5 10.58      0      0  3</span></span>
<span><span class="co">##   ---                            </span></span>
<span><span class="co">##  996:  996  8.87      1      2  2</span></span>
<span><span class="co">##  997:  997 10.27      0      0  3</span></span>
<span><span class="co">##  998:  998  6.84      0      1  1</span></span>
<span><span class="co">##  999:  999  9.28      0      2  1</span></span>
<span><span class="co">## 1000: 1000 10.80      1      2  3</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">study1</span><span class="op">[</span>, <span class="va">.N</span>, keyby <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">female</span>, <span class="va">rx</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##    female rx   N</span></span>
<span><span class="co">## 1:      0  1 249</span></span>
<span><span class="co">## 2:      0  2 248</span></span>
<span><span class="co">## 3:      0  3 248</span></span>
<span><span class="co">## 4:      1  1  85</span></span>
<span><span class="co">## 5:      1  2  85</span></span>
<span><span class="co">## 6:      1  3  85</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="more-details-on-data-definitions">More details on data definitions<a class="anchor" aria-label="anchor" href="#more-details-on-data-definitions"></a>
</h2>
<p>This section elaborates on the data definition process to provide
more details on how to create data sets.</p>
<div class="section level3">
<h3 id="formulas">Formulas<a class="anchor" aria-label="anchor" href="#formulas"></a>
</h3>
<p>The data definition table for a new data set is constructed
sequentially. As each new row or variable is added, the formula (and in
some cases the variance) can refer back to a previously defined
variable. The first row by necessity cannot refer to another variable,
so the formula must be a specific value (i.e. not a string formula).
Starting with the second row, the formula can either be a value or any
valid <code>R</code> equation with quotes and can include any variables
previously defined.</p>
<p>In the definition we created above, the probability being
<strong>female</strong> is a function of <strong>age</strong>, which was
previously defined. Likewise, the number of <strong>visits</strong> is a
function of both <strong>age</strong> and <strong>female</strong>. Since
<strong>age</strong> is the first row in the table, we had to use a
scalar to define the mean.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"age"</span>, dist <span class="op">=</span> <span class="st">"normal"</span>, formula <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    variance <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"female"</span>, dist <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>    formula <span class="op">=</span> <span class="st">"-2 + age * 0.1"</span>, link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"visits"</span>, dist <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>    formula <span class="op">=</span> <span class="st">"1.5 - 0.2 * age + 0.5 * female"</span>, link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span></code></pre></div>
<p>Formulas can include <code>R</code> functions or user-defined
functions. Here is an example with a user-defined function
<code>myinv</code> and the <code>log</code> function from base
<code>R</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myinv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fl">1</span><span class="op">/</span><span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"age"</span>, formula <span class="op">=</span> <span class="fl">10</span>, variance <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    dist <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"loginvage"</span>, formula <span class="op">=</span> <span class="st">"log(myinv(age))"</span>,</span>
<span>    variance <span class="op">=</span> <span class="fl">0.1</span>, dist <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">5</span>, <span class="va">def</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    id   age loginvage</span></span>
<span><span class="co">## 1:  1 10.31     -2.58</span></span>
<span><span class="co">## 2:  2  7.90     -1.94</span></span>
<span><span class="co">## 3:  3  9.83     -1.93</span></span>
<span><span class="co">## 4:  4  9.10     -2.42</span></span>
<span><span class="co">## 5:  5 10.18     -2.21</span></span></code></pre>
<p>Replication is an important aspect of data simulation - it is often
very useful to generate data under different sets of assumptions.
<code>simstudy</code> facilitates this in at least two different ways.
There is function <code>updateDef</code> which allows row by row changes
of a data definition table. In this case, we are changing the formula of
<strong>loginvage</strong> in <strong>def</strong> so that it uses the
function <code>log10</code> instead of <code>log</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">def10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/updateDef.html">updateDef</a></span><span class="op">(</span><span class="va">def</span>, changevar <span class="op">=</span> <span class="st">"loginvage"</span>, newformula <span class="op">=</span> <span class="st">"log10(myinv(age))"</span><span class="op">)</span></span>
<span><span class="va">def10</span></span></code></pre></div>
<pre><code><span><span class="co">##      varname           formula variance   dist     link</span></span>
<span><span class="co">## 1:       age                10        2 normal identity</span></span>
<span><span class="co">## 2: loginvage log10(myinv(age))      0.1 normal identity</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">5</span>, <span class="va">def10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    id   age loginvage</span></span>
<span><span class="co">## 1:  1  9.82    -0.338</span></span>
<span><span class="co">## 2:  2 10.97    -0.633</span></span>
<span><span class="co">## 3:  3 11.79    -1.267</span></span>
<span><span class="co">## 4:  4  9.74    -0.882</span></span>
<span><span class="co">## 5:  5 10.11    -1.519</span></span></code></pre>
<p>A more powerful feature of <code>simstudy</code> that allows for
dynamic definition tables is the external reference capability through
the <em>double-dot</em> notation. Any variable reference in a formula
that is preceded by “..” refers to an externally defined variable:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_effect</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"age"</span>, formula <span class="op">=</span> <span class="fl">10</span>, variance <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    dist <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"agemult"</span>, formula <span class="op">=</span> <span class="st">"age * ..age_effect"</span>,</span>
<span>    dist <span class="op">=</span> <span class="st">"nonrandom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">def</span></span></code></pre></div>
<pre><code><span><span class="co">##    varname            formula variance      dist     link</span></span>
<span><span class="co">## 1:     age                 10        2    normal identity</span></span>
<span><span class="co">## 2: agemult age * ..age_effect        0 nonrandom identity</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">def</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    id  age agemult</span></span>
<span><span class="co">## 1:  1 9.69    29.1</span></span>
<span><span class="co">## 2:  2 9.63    28.9</span></span></code></pre>
<p>But the real power of dynamic definition is seen in the context of
iteration over multiple values:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">list_of_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">age_effects</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">age_effect</span> <span class="op">&lt;-</span> <span class="va">age_effects</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">list_of_data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">def</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">list_of_data</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">##    id  age agemult</span></span>
<span><span class="co">## 1:  1 11.4       0</span></span>
<span><span class="co">## 2:  2 10.7       0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">##    id  age agemult</span></span>
<span><span class="co">## 1:  1 11.3    56.6</span></span>
<span><span class="co">## 2:  2 11.2    56.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">##    id   age agemult</span></span>
<span><span class="co">## 1:  1  9.32    93.2</span></span>
<span><span class="co">## 2:  2 10.62   106.2</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="distributions">Distributions<a class="anchor" aria-label="anchor" href="#distributions"></a>
</h3>
<p>The foundation of generating data is the assumptions we make about
the distribution of each variable. <code>simstudy</code> provides 15
types of distributions, which are listed in the following table:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="12%">
<col width="10%">
<col width="11%">
<col width="33%">
<col width="13%">
<col width="8%">
<col width="4%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">name</th>
<th align="left">formula</th>
<th align="left">string/value</th>
<th align="left">format</th>
<th align="left">variance</th>
<th align="center">identity</th>
<th align="center">log</th>
<th align="center">logit</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">beta</td>
<td align="left">mean</td>
<td align="left">both</td>
<td align="left">-</td>
<td align="left">dispersion</td>
<td align="center">X</td>
<td align="center">-</td>
<td align="center">X</td>
</tr>
<tr class="even">
<td align="left">binary</td>
<td align="left">probability</td>
<td align="left">both</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="center">X</td>
<td align="center">-</td>
<td align="center">X</td>
</tr>
<tr class="odd">
<td align="left">binomial</td>
<td align="left">probability</td>
<td align="left">both</td>
<td align="left">-</td>
<td align="left"># of trials</td>
<td align="center">X</td>
<td align="center">-</td>
<td align="center">X</td>
</tr>
<tr class="even">
<td align="left">categorical</td>
<td align="left">probability</td>
<td align="left">string</td>
<td align="left">p_1;p_2;…;p_n</td>
<td align="left">a;b;c</td>
<td align="center">X</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr class="odd">
<td align="left">clusterSize</td>
<td align="left">total N</td>
<td align="left">both</td>
<td align="left">-</td>
<td align="left">dispersion</td>
<td align="center">X</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr class="even">
<td align="left">exponential</td>
<td align="left">mean</td>
<td align="left">both</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="center">X</td>
<td align="center">X</td>
<td align="center">-</td>
</tr>
<tr class="odd">
<td align="left">gamma</td>
<td align="left">mean</td>
<td align="left">both</td>
<td align="left">-</td>
<td align="left">dispersion</td>
<td align="center">X</td>
<td align="center">X</td>
<td align="center">-</td>
</tr>
<tr class="even">
<td align="left">mixture</td>
<td align="left">formula</td>
<td align="left">string</td>
<td align="left">x_1 | p_1 + … + x_n | p_n</td>
<td align="left">-</td>
<td align="center">X</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr class="odd">
<td align="left">negBinomial</td>
<td align="left">mean</td>
<td align="left">both</td>
<td align="left">-</td>
<td align="left">dispersion</td>
<td align="center">X</td>
<td align="center">X</td>
<td align="center">-</td>
</tr>
<tr class="even">
<td align="left">nonrandom</td>
<td align="left">formula</td>
<td align="left">both</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="center">X</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr class="odd">
<td align="left">normal</td>
<td align="left">mean</td>
<td align="left">both</td>
<td align="left">-</td>
<td align="left">variance</td>
<td align="center">X</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr class="even">
<td align="left">noZeroPoisson</td>
<td align="left">mean</td>
<td align="left">both</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="center">X</td>
<td align="center">X</td>
<td align="center">-</td>
</tr>
<tr class="odd">
<td align="left">poisson</td>
<td align="left">mean</td>
<td align="left">both</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="center">X</td>
<td align="center">X</td>
<td align="center">-</td>
</tr>
<tr class="even">
<td align="left">trtAssign</td>
<td align="left">ratio</td>
<td align="left">string</td>
<td align="left">r_1;r_2;…;r_n</td>
<td align="left">stratification</td>
<td align="center">X</td>
<td align="center">X</td>
<td align="center">-</td>
</tr>
<tr class="odd">
<td align="left">uniform</td>
<td align="left">range</td>
<td align="left">string</td>
<td align="left">from ; to</td>
<td align="left">-</td>
<td align="center">X</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr class="even">
<td align="left">uniformInt</td>
<td align="left">range</td>
<td align="left">string</td>
<td align="left">from ; to</td>
<td align="left">-</td>
<td align="center">X</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
</tbody>
</table>
<div class="section level4">
<h4 id="beta">beta<a class="anchor" aria-label="anchor" href="#beta"></a>
</h4>
<p>A <em>beta</em> distribution is a continuous data distribution that
takes on values between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>. The <code>formula</code> specifies the
mean <span class="math inline">\(\mu\)</span> (with the ‘identity’ link)
or the log-odds of the mean (with the ‘logit’ link). The scalar value in
the ‘variance’ represents the dispersion value <span class="math inline">\(d\)</span>. The variance <span class="math inline">\(\sigma^2\)</span> for a beta distributed variable
will be <span class="math inline">\(\mu (1- \mu)/(1 + d)\)</span>.
Typically, the beta distribution is specified using two shape parameters
<span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, where <span class="math inline">\(\mu = \alpha/(\alpha + \beta)\)</span> and <span class="math inline">\(\sigma^2 = \alpha\beta/[(\alpha + \beta)^2 (\alpha
+ \beta + 1)]\)</span>.</p>
</div>
<div class="section level4">
<h4 id="binary">binary<a class="anchor" aria-label="anchor" href="#binary"></a>
</h4>
<p>A <em>binary</em> distribution is a discrete data distribution that
takes values <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>. (It is more conventionally called a
<em>Bernoulli</em> distribution, or is a <em>binomial</em> distribution
with a single trial <span class="math inline">\(n=1\)</span>.) The
<code>formula</code> represents the probability (with the ‘identity’
link) or the log odds (with the ‘logit’ link) that the variable takes
the value of 1. The mean of this distribution is <span class="math inline">\(p\)</span>, and variance <span class="math inline">\(\sigma^2\)</span> is <span class="math inline">\(p(1-p)\)</span>.</p>
</div>
<div class="section level4">
<h4 id="binomial">binomial<a class="anchor" aria-label="anchor" href="#binomial"></a>
</h4>
<p>A <em>binomial</em> distribution is a discrete data distribution that
represents the count of the number of successes given a number of
trials. The formula specifies the probability of success <span class="math inline">\(p\)</span>, and the variance field is used to
specify the number of trials <span class="math inline">\(n\)</span>.
Given a value of <span class="math inline">\(p\)</span>, the mean <span class="math inline">\(\mu\)</span> of this distribution is <span class="math inline">\(n*p\)</span>, and the variance <span class="math inline">\(\sigma^2\)</span> is <span class="math inline">\(np(1-p)\)</span>.</p>
</div>
<div class="section level4">
<h4 id="categorical">categorical<a class="anchor" aria-label="anchor" href="#categorical"></a>
</h4>
<p>A <em>categorical</em> distribution is a discrete data distribution
taking on values from <span class="math inline">\(1\)</span> to <span class="math inline">\(K\)</span>, with each value representing a
specific category, and there are <span class="math inline">\(K\)</span>
categories. The categories may or may not be ordered. For a categorical
variable with <span class="math inline">\(k\)</span> categories, the
<code>formula</code> is a string of probabilities that sum to 1, each
separated by a semi-colon: <span class="math inline">\((p_1 ; p_2 ; ...
; p_k)\)</span>. <span class="math inline">\(p_1\)</span> is the
probability of the random variable falling in category <span class="math inline">\(1\)</span>, <span class="math inline">\(p_2\)</span> is the probability of category <span class="math inline">\(2\)</span>, etc. The probabilities can be
specified as functions of other variables previously defined. The helper
function <code>genCatFormula</code> is an easy way to create different
probability strings. The <code>link</code> options are <em>identity</em>
or <em>logit</em>. The <code>variance</code> field is optional an allows
to provide categories other than the default <code>1...n</code> in the
same format as <code>formula</code>: “a;b;c”. Numeric variance Strings
(e.g. “50;100;200”) will be converted to numeric when possible. All
probabilities will be rounded to 1e12 decimal points to prevent possible
rounding errors.</p>
</div>
<div class="section level4">
<h4 id="clustersize">clusterSize<a class="anchor" aria-label="anchor" href="#clustersize"></a>
</h4>
<p>The <em>clusterSize</em> distribution allocates a total sample size
<em>N</em> (specified in the <em>formula</em> argument) across the
<em>k</em> rows of the data.table such that the sum of the rows equals
<em>N</em>. If the <em>dispersion</em> argument is set to 0, the
allocation to each row is <em>N/k</em>, with some rows getting an
increment of 1 to ensure that the sum is N. It is possible to relax the
assumption of balanced cluster sizes by setting <em>dispersion &gt;
0</em>. As the dispersion, the variability of cluster sizes across
clusters increases.</p>
</div>
<div class="section level4">
<h4 id="exponential">exponential<a class="anchor" aria-label="anchor" href="#exponential"></a>
</h4>
<p>An <em>exponential</em> distribution is a continuous data
distribution that takes on non-negative values. The <code>formula</code>
represents the mean <span class="math inline">\(\theta\)</span> (with
the ‘identity’ link) or log of the mean (with the ‘log’ link). The
<code>variance</code> argument does not apply to the
<em>exponential</em> distribution. The variance <span class="math inline">\(\sigma^2\)</span> is <span class="math inline">\(\theta^2\)</span>.</p>
</div>
<div class="section level4">
<h4 id="gamma">gamma<a class="anchor" aria-label="anchor" href="#gamma"></a>
</h4>
<p>A <em>gamma</em> distribution is a continuous data distribution that
takes on non-negative values. The <code>formula</code> specifies the
mean <span class="math inline">\(\mu\)</span> (with the ‘identity’ link)
or the log of the mean (with the ‘log’ link). The <code>variance</code>
field represents a dispersion value <span class="math inline">\(d\)</span>. The variance <span class="math inline">\(\sigma^2\)</span> is is <span class="math inline">\(d \mu^2\)</span>.</p>
</div>
<div class="section level4">
<h4 id="mixture">mixture<a class="anchor" aria-label="anchor" href="#mixture"></a>
</h4>
<p>The <em>mixture</em> distribution is a mixture of other predefined
variables, which can be defined based on any of the other available
distributions. The formula is a string structured with a sequence of
variables <span class="math inline">\(x_i\)</span> and probabilities
<span class="math inline">\(p_i\)</span>: <span class="math inline">\(x_1 | p_1 + … + x_n | p_n\)</span>. All of the
<span class="math inline">\(x_i\)</span>’s are required to have been
previously defined, and the probabilities must sum to <span class="math inline">\(1\)</span> (i.e. <span class="math inline">\(\sum_1^n p_i = 1\)</span>). The result of
generating from a mixture is the value <span class="math inline">\(x_i\)</span> with probability <span class="math inline">\(p_i\)</span>. The <code>variance</code> and
<code>link</code> fields do not apply to the <em>mixture</em>
distribution.</p>
</div>
<div class="section level4">
<h4 id="negbinomial">negBinomial<a class="anchor" aria-label="anchor" href="#negbinomial"></a>
</h4>
<p>A <em>negative binomial</em> distribution is a discrete data
distribution that represents the number of successes that occur in a
sequence of <em>Bernoulli</em> trials before a specified number of
failures occurs. It is often used to model count data more generally
when a <em>Poisson</em> distribution is not considered appropriate; the
variance of the negative binomial distribution is larger than the
<em>Poisson</em> distribution. The <code>formula</code> specifies the
mean <span class="math inline">\(\mu\)</span> or the log of the mean.
The variance field represents a dispersion value <span class="math inline">\(d\)</span>. The variance <span class="math inline">\(\sigma^2\)</span> will be <span class="math inline">\(\mu + d\mu^2\)</span>.</p>
</div>
<div class="section level4">
<h4 id="nonrandom">nonrandom<a class="anchor" aria-label="anchor" href="#nonrandom"></a>
</h4>
<p>Deterministic data can be “generated” using the <em>nonrandom</em>
distribution. The <code>formula</code> explicitly represents the value
of the variable to be generated, without any uncertainty. The
<code>variance</code> and <code>link</code> fields do not apply to
<em>nonrandom</em> data generation.</p>
</div>
<div class="section level4">
<h4 id="normal">normal<a class="anchor" aria-label="anchor" href="#normal"></a>
</h4>
<p>A <em>normal</em> or <em>Gaussian</em> distribution is a continuous
data distribution that takes on values between <span class="math inline">\(-\infty\)</span> and <span class="math inline">\(\infty\)</span>. The <code>formula</code>
represents the mean <span class="math inline">\(\mu\)</span> and the
<code>variance</code> represents <span class="math inline">\(\sigma^2\)</span>. The <code>link</code> field is
not applied to the <em>normal</em> distribution.</p>
</div>
<div class="section level4">
<h4 id="nozeropoisson">noZeroPoisson<a class="anchor" aria-label="anchor" href="#nozeropoisson"></a>
</h4>
<p>The <em>noZeroPoisson</em> distribution is a discrete data
distribution that takes on positive integers. This is a truncated
<em>poisson</em> distribution that excludes <span class="math inline">\(0\)</span>. The <code>formula</code> specifies the
parameter <span class="math inline">\(\lambda\)</span> (link is
‘identity’) or log() (<code>link</code> is log). The
<code>variance</code> field does not apply to this distribution. The
mean <span class="math inline">\(\mu\)</span> of this distribution is
<span class="math inline">\(\lambda/(1-e^{-\lambda})\)</span> and the
variance <span class="math inline">\(\sigma^2\)</span> is <span class="math inline">\((\lambda + \lambda^2)/(1-e^{-\lambda}) -
\lambda^2/(1-e^{-\lambda})^2\)</span>. We are not typically interested
in modeling data drawn from this distribution (except in the case of a
<em>hurdle model</em>), but it is useful to generate positive count data
where it is not desirable to have any <span class="math inline">\(0\)</span> values.</p>
</div>
<div class="section level4">
<h4 id="poisson">poisson<a class="anchor" aria-label="anchor" href="#poisson"></a>
</h4>
<p>The <em>poisson</em> distribution is a discrete data distribution
that takes on non-negative integers. The <code>formula</code> specifies
the mean <span class="math inline">\(\lambda\)</span> (link is
‘identity’) or log of the mean (<code>link</code> is log). The
<code>variance</code> field does not apply to this distribution. The
variance <span class="math inline">\(\sigma^2\)</span> is <span class="math inline">\(\lambda\)</span> itself.</p>
</div>
<div class="section level4">
<h4 id="trtassign">trtAssign<a class="anchor" aria-label="anchor" href="#trtassign"></a>
</h4>
<p>The <em>trtAssign</em> distribution is an implementation of the
<code>trtAssign</code> functionality in the context of the
<code>defData</code> workflow. Sometimes, it might be convenient to
assign treatment or group membership while defining other variables. The
<code>formula</code> specifies the relative allocation to the different
groups. For example three-arm randomization with equal allocation to
each arm would be specified as <em>“1;1;1”</em>. The
<code>variance</code> field defines the stratification variables, and
would be specified as <em>“s_1;s_2”</em> if <em>s_1</em> and
<em>s_2</em> are the stratification variables. The <code>link</code>
field is used to indicate if the allocations should be perfectly
balanced; if nothing is specified (and link defaults to
<em>identity</em>), the allocation will be balanced; if link is
specified to be different from <em>identity</em>, then the allocation
will not be balanced.</p>
</div>
<div class="section level4">
<h4 id="uniform">uniform<a class="anchor" aria-label="anchor" href="#uniform"></a>
</h4>
<p>A <em>uniform</em> distribution is a continuous data distribution
that takes on values from <span class="math inline">\(a\)</span> to
<span class="math inline">\(b\)</span>, where <span class="math inline">\(b\)</span> &gt; <span class="math inline">\(a\)</span>, and they both lie anywhere on the real
number line. The <code>formula</code> is a string with the format “a;b”,
where <em>a</em> and <em>b</em> are scalars or functions of previously
defined variables. The <code>variance</code> and <code>link</code>
arguments do not apply to the <em>uniform</em> distribution.</p>
</div>
<div class="section level4">
<h4 id="uniformint">uniformInt<a class="anchor" aria-label="anchor" href="#uniformint"></a>
</h4>
<p>A <em>uniform integer</em> distribution is a discrete data
distribution that takes on values from <span class="math inline">\(a\)</span> to <span class="math inline">\(b\)</span>, where <span class="math inline">\(b\)</span> &gt; <span class="math inline">\(a\)</span>, and they both lie anywhere on the
integer number line. The <code>formula</code> is a string with the
format “a;b”, where <em>a</em> and <em>b</em> are scalars or functions
of previously defined variables. The <code>variance</code> and
<code>link</code> arguments do not apply to the <em>uniform integer</em>
distribution.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="generating-multiple-variables-with-a-single-definition">Generating multiple variables with a single definition<a class="anchor" aria-label="anchor" href="#generating-multiple-variables-with-a-single-definition"></a>
</h2>
<p><code>defRepeat</code> allows us to specify multiple versions of a
variable based on a single set of distribution assumptions. The function
will add <code>nvar</code> variables to the <em>data definition</em>
table, each of which will be specified with a single set of distribution
assumptions. The names of the variables will be based on the
<code>prefix</code> argument and the distribution assumptions are
specified as they are in the <code>defData</code> function. Calls to
<code>defRepeat</code> can be integrated with calls to
<code>defData</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defRepeat.html">defRepeat</a></span><span class="op">(</span>nVars <span class="op">=</span> <span class="fl">4</span>, prefix <span class="op">=</span> <span class="st">"g"</span>, formula <span class="op">=</span> <span class="st">"1/3;1/3;1/3"</span>,</span>
<span>    variance <span class="op">=</span> <span class="fl">0</span>, dist <span class="op">=</span> <span class="st">"categorical"</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"a"</span>, formula <span class="op">=</span> <span class="st">"1;1"</span>, dist <span class="op">=</span> <span class="st">"trtAssign"</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defRepeat.html">defRepeat</a></span><span class="op">(</span><span class="va">def</span>, <span class="fl">3</span>, <span class="st">"b"</span>, formula <span class="op">=</span> <span class="st">"5 + a"</span>, variance <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    dist <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, <span class="st">"y"</span>, formula <span class="op">=</span> <span class="st">"0.10"</span>, dist <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">def</span></span></code></pre></div>
<pre><code><span><span class="co">##    varname     formula variance        dist     link</span></span>
<span><span class="co">## 1:      g1 1/3;1/3;1/3        0 categorical identity</span></span>
<span><span class="co">## 2:      g2 1/3;1/3;1/3        0 categorical identity</span></span>
<span><span class="co">## 3:      g3 1/3;1/3;1/3        0 categorical identity</span></span>
<span><span class="co">## 4:      g4 1/3;1/3;1/3        0 categorical identity</span></span>
<span><span class="co">## 5:       a         1;1        0   trtAssign identity</span></span>
<span><span class="co">## 6:      b1       5 + a        3      normal identity</span></span>
<span><span class="co">## 7:      b2       5 + a        3      normal identity</span></span>
<span><span class="co">## 8:      b3       5 + a        3      normal identity</span></span>
<span><span class="co">## 9:       y        0.10        0      binary identity</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="adding-data-to-an-existing-data-table">Adding data to an existing data table<a class="anchor" aria-label="anchor" href="#adding-data-to-an-existing-data-table"></a>
</h2>
<p>Until this point, we have been generating new data sets, building
them up from scratch. However, it is often necessary to generate the
data in multiple stages so that we would need to add data as we go
along. For example, we may have multi-level data with clusters that
contain collections of individual observations. The data generation
might begin with defining and generating cluster-level variables,
followed by the definition and generation of the individual-level data;
the individual-level data set would be adding to the cluster-level data
set.</p>
<div class="section level3">
<h3 id="defdataadddefrepeataddreaddataadd-and-addcolumns">defDataAdd/defRepeatAdd/readDataAdd and addColumns<a class="anchor" aria-label="anchor" href="#defdataadddefrepeataddreaddataadd-and-addcolumns"></a>
</h3>
<p>There are several important functions that facilitate the
augmentation of data sets. <code>defDataAdd</code>,
<code>defRepeatAdd</code>, and <code>readDataAdd</code> are similar to
their counterparts <code>defData</code>, <code>defRepeat</code>, and
<code>readData</code>, respectively; they create data definition tables
that will be used by the function <code>addColumns</code>. The formulas
in these “<em>add</em>-ing” functions are permitted to refer to fields
that exist in the data set to be augmented, so all variables need not be
defined in the current definition able.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"x1"</span>, formula <span class="op">=</span> <span class="fl">0</span>, variance <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    dist <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span><span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">d1</span>, varname <span class="op">=</span> <span class="st">"x2"</span>, formula <span class="op">=</span> <span class="fl">0.5</span>, dist <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defRepeatAdd.html">defRepeatAdd</a></span><span class="op">(</span>nVars <span class="op">=</span> <span class="fl">2</span>, prefix <span class="op">=</span> <span class="st">"q"</span>, formula <span class="op">=</span> <span class="st">"5 + 3*rx"</span>,</span>
<span>    variance <span class="op">=</span> <span class="fl">4</span>, dist <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defDataAdd.html">defDataAdd</a></span><span class="op">(</span><span class="va">d2</span>, varname <span class="op">=</span> <span class="st">"y"</span>, formula <span class="op">=</span> <span class="st">"-2 + 0.5*x1 + 0.5*x2 + 1*rx"</span>,</span>
<span>    dist <span class="op">=</span> <span class="st">"binary"</span>, link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">5</span>, <span class="va">d1</span><span class="op">)</span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trtAssign.html">trtAssign</a></span><span class="op">(</span><span class="va">dd</span>, nTrt <span class="op">=</span> <span class="fl">2</span>, grpName <span class="op">=</span> <span class="st">"rx"</span><span class="op">)</span></span>
<span><span class="va">dd</span></span></code></pre></div>
<pre><code><span><span class="co">##    id      x1 x2 rx</span></span>
<span><span class="co">## 1:  1 -1.3230  1  0</span></span>
<span><span class="co">## 2:  2 -0.0494  0  1</span></span>
<span><span class="co">## 3:  3 -0.4064  1  0</span></span>
<span><span class="co">## 4:  4 -0.5562  1  0</span></span>
<span><span class="co">## 5:  5 -0.0941  0  1</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addColumns.html">addColumns</a></span><span class="op">(</span><span class="va">d2</span>, <span class="va">dd</span><span class="op">)</span></span>
<span><span class="va">dd</span></span></code></pre></div>
<pre><code><span><span class="co">##    id      x1 x2 rx    q1    q2 y</span></span>
<span><span class="co">## 1:  1 -1.3230  1  0 4.589  5.70 0</span></span>
<span><span class="co">## 2:  2 -0.0494  0  1 9.829 11.74 1</span></span>
<span><span class="co">## 3:  3 -0.4064  1  0 2.117  4.47 0</span></span>
<span><span class="co">## 4:  4 -0.5562  1  0 0.798  3.24 0</span></span>
<span><span class="co">## 5:  5 -0.0941  0  1 7.601  6.98 0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="defcondition-and-addcondition">defCondition and addCondition<a class="anchor" aria-label="anchor" href="#defcondition-and-addcondition"></a>
</h3>
<p>In certain situations, it might be useful to define a data
distribution conditional on previously generated data in a way that is
more complex than might be easily handled by a single formula.
<code>defCondition</code> creates a special table of definitions and the
new variable is added to an existing data set by calling
<code>addCondition</code>. <code>defCondition</code> specifies a
condition argument that will be based on a variable that already exists
in the data set. The new variable can take on any <code>simstudy</code>
distribution specified with the appropriate <code>formula</code>,
<code>variance</code>, and <code>link</code> arguments.</p>
<p>In this example, the slope of a regression line of <span class="math inline">\(y\)</span> on <span class="math inline">\(x\)</span> varies depending on the value of the
predictor <span class="math inline">\(x\)</span>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"x"</span>, formula <span class="op">=</span> <span class="fl">0</span>, variance <span class="op">=</span> <span class="fl">9</span>, dist <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defCondition.html">defCondition</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="st">"x &lt;= -2"</span>, formula <span class="op">=</span> <span class="st">"4 + 3*x"</span>,</span>
<span>    variance <span class="op">=</span> <span class="fl">2</span>, dist <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span><span class="va">dc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defCondition.html">defCondition</a></span><span class="op">(</span><span class="va">dc</span>, condition <span class="op">=</span> <span class="st">"x &gt; -2 &amp; x &lt;= 2"</span>, formula <span class="op">=</span> <span class="st">"0 + 1*x"</span>,</span>
<span>    variance <span class="op">=</span> <span class="fl">4</span>, dist <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span><span class="va">dc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defCondition.html">defCondition</a></span><span class="op">(</span><span class="va">dc</span>, condition <span class="op">=</span> <span class="st">"x &gt; 2"</span>, formula <span class="op">=</span> <span class="st">"-5 + 4*x"</span>,</span>
<span>    variance <span class="op">=</span> <span class="fl">3</span>, dist <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="va">d</span><span class="op">)</span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addCondition.html">addCondition</a></span><span class="op">(</span><span class="va">dc</span>, <span class="va">dd</span>, newvar <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="simstudy_files/figure-html/unnamed-chunk-16-1.png" width="480"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://www.rdatagen.net/" class="external-link">Keith Goldfeld</a>, Jacob Wujciak-Jens.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
